&GLOBAL
	PROJECT hit
	RUN_TYPE MD
	IOLEVEL  LOW 
&END GLOBAL
&FORCE_EVAL 
	METHOD Quickstep 
	&DFT
		BASIS_SET_FILE_NAME BASIS_MOLOPT_UZH
		POTENTIAL_FILE_NAME POTENTIAL_UZH
		CHARGE 0   ! tune this?
		MULTIPLICITY 1    ! tune this?
	!	ACTIVATEUKS UKS TRUE  ! Enables unrestricted Kohn-Sham DFT
	!	ACTIVATEUKS RELAX_MULTIPLICITY 0     ! let spins flip
		
		&QS 
			METHOD GPW
			EPS_DEFAULT 1.0E-8				! sets reasonable values for all other thresholds.
			EXTRAPOLATION ASPC				! used for MD, the method used to generate the initial guess. 
		&END QS 
		
		&MGRID 
			CUTOFF [Ry] 400.0
		&END MGRID
		
		&SCF
			SCF_GUESS ATOMIC 				! can be used to RESTART an interrupted calculation
			MAX_SCF 100
			EPS_SCF 1.0E-5 					! accuracy of the SCF procedure typically 1.0E-6 - 1.0E-7
			
			&OT
				PRECONDITIONER FULL_SINGLE_INVERSE			        ! an accurate preconditioner suitable also for larger systems
			&END OT
			
			&OUTER_SCF 						! repeat the inner SCF cycle 10 times
				MAX_SCF 10
				EPS_SCF 1.0E-5 					! must match the above
				OPTIMIZER DIIS 
			&END OUTER_SCF 
		&END SCF
		
		&XC 
			&XC_FUNCTIONAL
				&PBE
				&END PBE
			&END XC_FUNCTIONAL
			&VDW_POTENTIAL
				POTENTIAL_TYPE PAIR_POTENTIAL
				&PAIR_POTENTIAL
					TYPE               DFTD3(BJ)
					R_CUTOFF           10.924076799328082
					REFERENCE_FUNCTIONAL   PBE
					PARAMETER_FILE_NAME dftd3.dat
				&END PAIR_POTENTIAL
			&END VDW_POTENTIAL
		&END XC
	&END DFT
	&SUBSYS
		&COLVAR
			&XYZ_DIAG                    ! instantaneous position CV
				ATOM 65                   ! the atom you care about
				COMPONENT Z                ! take only its Z component
				ABSOLUTE_POSITION          ! use the instant position
				PBC F                      ! to not get coords [-Lz/2; Lz/2], in which it's hard to put a wall later
			&END XYZ_DIAG
		&END COLVAR
		
		&CELL 
			A 12.614037361480426 0.0 0.0
			B -6.30701868074021 10.924076799328082 0.0
			C 0.0 0.0 50.0
		&END CELL
		
		&TOPOLOGY
			COORD_FILE_NAME COORD_hit.xyz
			COORD_FILE_FORMAT XYZ
		&END TOPOLOGY
		
		&VELOCITY   ! [bohr / au_t = bohr / (hbar / E_Hart) = E_Hart * bohr / hbar]
			3.2516749758e-05 -1.1127395891e-04 -4.6155104238e-06
			-4.2121730142e-05 -3.9411343514e-05 1.3302502598e-04
			-1.6001853942e-05 -1.2229162138e-06 -1.0307425624e-05
			-3.8295403442e-05 -3.8078611914e-05 -1.5542113124e-05
			-1.0024438842e-05 -1.8282077591e-04 -1.3569604212e-04
			-2.1530828142e-05 5.4462709862e-06 2.3873977876e-05
			-9.8935987142e-05 -6.9163401914e-05 2.3993248988e-04
			6.2028628358e-05 3.6507827862e-06 4.9935593936e-05
			6.1055575258e-05 -4.8688534114e-05 1.6743387188e-04
			5.1791209758e-05 1.6114615809e-04 1.1833383498e-04
			1.2088774586e-04 1.1522005639e-04 1.5219656888e-04
			-5.2682006942e-05 -4.0815192914e-05 1.7898825388e-04
			1.3290152586e-04 7.8625901686e-05 9.0476805576e-05
			-4.3059903150e-07 3.1526749961e-05 1.0382104518e-04
			-3.9344610042e-05 9.7723026986e-05 1.5078459788e-04
			2.8077117458e-05 -7.8856576138e-06 4.7971402176e-05
			3.4788700286e-04 -1.6429908191e-04 3.2256637516e-05
			5.7393217158e-05 3.6729472056e-05 -5.5587023024e-05
			-2.3610534914e-04 5.7582855886e-05 -2.3723254712e-04
			-5.9130873742e-05 6.6093362286e-05 -2.9945924724e-05
			1.9005746886e-04 1.0656000419e-04 -2.7342185424e-05
			-2.2491003515e-06 1.7667683909e-04 3.7710565762e-06
			5.7602463058e-05 1.4373361609e-04 1.6044744476e-05
			-1.0477429814e-04 9.2422193986e-05 5.2900370076e-05
			-2.1520760014e-04 -4.1501673138e-06 8.0226117776e-05
			4.7488453558e-05 -2.1656710591e-04 -1.1933415112e-04
			9.2982729850e-07 7.2143368286e-05 1.3351802448e-04
			1.9849158886e-04 3.3004232862e-06 -8.4708148124e-05
			-9.8421014242e-05 -1.0003663891e-04 2.8789280376e-05
			-7.8238919442e-05 -4.7831026614e-05 -1.4847850912e-04
			5.2400506258e-05 1.8079645909e-04 2.3259406688e-04
			-1.0537220314e-04 1.6980208009e-04 -4.2214464624e-05
			-1.8191128314e-04 -2.0389332591e-04 3.6573092416e-05
			-2.3593829214e-04 -1.4528519991e-04 8.3458181676e-05
			-3.0091204414e-04 5.7649320286e-05 9.4019325276e-05
			1.9824692486e-04 -7.1622364914e-05 3.8109061296e-05
			-3.9396488115e-06 3.0601112896e-05 3.6000057626e-05
			-1.0382118214e-04 -1.5550936391e-04 1.9871608088e-04
			-5.0723785842e-05 -1.7609658414e-05 -9.8454886124e-05
			-1.2644703842e-05 6.7559096986e-05 1.3657409688e-04
			1.9062577986e-04 -8.3716058914e-05 1.4238542088e-04
			-1.3447301814e-04 -2.8069626891e-04 -7.4876137124e-05
			-1.7856914214e-04 6.5760263486e-05 9.4834076576e-05
			2.5847539286e-04 -6.6277973414e-05 1.1285291308e-04
			1.1998508486e-04 5.6781678615e-07 2.0745431988e-04
			-3.0925121614e-04 8.3585140586e-05 1.0797492588e-04
			2.6024921686e-04 2.2518986109e-04 5.0255180762e-06
			2.6764075858e-05 -5.5762647814e-05 4.4499181616e-05
			8.9618887458e-05 -5.8874142114e-05 5.0971091288e-04
			-8.2390688842e-05 1.2938722559e-04 -1.4892660312e-04
			-2.4363650142e-05 1.8475580309e-04 -2.3888689112e-04
			5.5758990758e-05 -1.3211351691e-04 7.7087625276e-05
			-2.7613915942e-05 6.6634572986e-05 6.6165223676e-05
			-2.7059228214e-04 4.2019397909e-04 -2.0847993912e-04
			3.8449158558e-05 6.4055816486e-05 -1.1356451812e-04
			-5.2354073214e-04 1.0566326549e-04 1.0801512468e-04
			3.6244297658e-05 3.0807203809e-04 -1.3449339612e-04
			-1.4913211814e-04 -3.1567423591e-04 -8.2377546124e-05
			6.1435332458e-05 -1.7255224791e-04 1.8077350588e-04
			2.0432597086e-04 -8.2138804914e-05 9.8171959576e-05
			1.6224777486e-04 -3.8662637591e-04 -2.3544677912e-04
			-2.5722414314e-04 1.3470770609e-04 -6.2272080238e-06
			3.0058226886e-04 -1.0291576191e-04 -4.1095363024e-05
			1.7918526086e-04 6.6335584086e-05 2.2993343762e-06
			0.0000000000e+00 0.0000000000e+00 -3.8358851614e-03
		&END VELOCITY
		&KIND Mo
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q14
			POTENTIAL GTH-GGA-q14
		&END KIND
		&KIND S
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q6
			POTENTIAL GTH-GGA-q6
		&END KIND
		&KIND O
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q6
			POTENTIAL GTH-GGA-q6
		&END KIND
		&KIND Ar
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q8
			POTENTIAL GTH-GGA-q8
		&END KIND
	&END SUBSYS 
&END FORCE_EVAL
&MOTION
!	&COMVEL_TOL 1e-8  ! enforce |V_com| < 1e-8
	
!	&CONSTRAINT
!		&FIXED_ATOMS
!			LIST 19 36  ! why this? they seem to be close (through PBC)
!			LIST 19     ! can we do 1? Yuri chose 2
!		&END FIXED_ATOMS
!	&END CONSTRAINT 
	&FREE_ENERGY
		&METADYN
			!DO_HILLS  FALSE                                 ! default
			
			&METAVAR
				COLVAR   1
				SCALE 1.0
				
				&WALL
					POSITION [angstrom]  40.1048
					TYPE       REFLECTIVE                        ! mirror wall
					&REFLECTIVE
						DIRECTION  WALL_PLUS                        
					&END REFLECTIVE
				&END WALL
			&END METAVAR
			
			&PRINT
				&COLVAR
					FILENAME      =ion_z.dat
					COMMON_ITERATION_LEVELS 3
					&EACH                                 ! choose the stride (iteration level) :contentReference[oaicite:8]{index=8}
						MD 1                               ! every MD integration step
					&END EACH
				&END COLVAR
			&END PRINT
			
		&END METADYN
	&END FREE_ENERGY
	
	&MD
		ENSEMBLE NVE  
	!	TEMPERATURE [K] 350
		TIMESTEP [fs] 1.0
		STEPS 5000
	!	&THERMOSTAT
	!		REGION MASSIVE
	!		TYPE CSVR 
	!		&CSVR 
	!			TIMECON 200 
	!		&END CSVR 
	!	&END THERMOSTAT
	&END MD 
	
	&PRINT
		&TRAJECTORY
			&EACH
				MD 10
			&END EACH
		&END TRAJECTORY
		
		&VELOCITIES
			&EACH
				MD 10
			&END EACH
		&END VELOCITIES
		
		&FORCES OFF
		&END FORCES
		
		&RESTART_HISTORY
			&EACH
				MD 30
			&END EACH
		&END RESTART_HISTORY
		
		&RESTART
			BACKUP_COPIES 3
			&EACH
				MD 10
			&END EACH
		&END RESTART
	&END PRINT
&END 


