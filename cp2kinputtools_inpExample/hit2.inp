&GLOBAL
	PROJECT hit
	RUN_TYPE MD
	IOLEVEL  LOW 
&END GLOBAL
&FORCE_EVAL 
	METHOD Quickstep 
	&DFT
		BASIS_SET_FILE_NAME BASIS_MOLOPT_UZH
		POTENTIAL_FILE_NAME POTENTIAL_UZH
		CHARGE 0   ! tune this?
		MULTIPLICITY 1    ! tune this?
	!	ACTIVATEUKS UKS TRUE  ! Enables unrestricted Kohn-Sham DFT
	!	ACTIVATEUKS RELAX_MULTIPLICITY 0     ! let spins flip
		
		&QS 
			METHOD GPW
			EPS_DEFAULT 1.0E-8				! sets reasonable values for all other thresholds.
			EXTRAPOLATION ASPC				! used for MD, the method used to generate the initial guess. 
		&END QS 
		
		&MGRID 
			CUTOFF [Ry] 400.0
		&END MGRID
		
		&SCF
			SCF_GUESS ATOMIC 				! can be used to RESTART an interrupted calculation
			MAX_SCF 100
			EPS_SCF 1.0E-5 					! accuracy of the SCF procedure typically 1.0E-6 - 1.0E-7
			
			&OT
				PRECONDITIONER FULL_SINGLE_INVERSE			        ! an accurate preconditioner suitable also for larger systems
			&END OT
			
			&OUTER_SCF 						! repeat the inner SCF cycle 10 times
				MAX_SCF 10
				EPS_SCF 1.0E-5 					! must match the above
				OPTIMIZER DIIS 
			&END OUTER_SCF 
		&END SCF
		
		&XC 
			&XC_FUNCTIONAL
				&PBE
				&END PBE
			&END XC_FUNCTIONAL
			&VDW_POTENTIAL
				POTENTIAL_TYPE PAIR_POTENTIAL
				&PAIR_POTENTIAL
					TYPE               DFTD3(BJ)
					R_CUTOFF           10.924076799328082
					REFERENCE_FUNCTIONAL   PBE
					PARAMETER_FILE_NAME dftd3.dat
				&END PAIR_POTENTIAL
			&END VDW_POTENTIAL
		&END XC
	&END DFT
	&SUBSYS
		&COLVAR
			&XYZ_DIAG                    ! "instantaneous position" CV
				ATOM 65                   ! the atom you care about
				COMPONENT Z                ! take only its Z component
				ABSOLUTE_POSITION          ! use the instant position
				PBC F                      ! to not get coords [-Lz/2; Lz/2], in which it's hard to put a wall later
			&END XYZ_DIAG
		&END COLVAR
		
		&CELL 
			A 12.614037361480426 0.0 0.0
			B -6.30701868074021 10.924076799328082 0.0
			C 0.0 0.0 50.0
		&END CELL
		
		&TOPOLOGY
			COORD_FILE_NAME COORD_hit.xyz
			COORD_FILE_FORMAT XYZ
		&END TOPOLOGY
		
		&VELOCITY   ! [bohr / au_t = bohr / (hbar / E_Hart) = E_Hart * bohr / hbar]
			3.2516749758e-05 -1.3846983769e-04 -1.1902624178e-05
			-4.2121730142e-05 -6.6607222286e-05 1.2573791222e-04
			-1.6001853942e-05 -2.8418794986e-05 -1.7594539378e-05
			-3.8295403442e-05 -6.5274490686e-05 -2.2829226878e-05
			-1.0024438842e-05 -2.1001665469e-04 -1.4298315588e-04
			-2.1530828142e-05 -2.1749607786e-05 1.6586864122e-05
			-9.8935987142e-05 -9.6359280686e-05 2.3264537612e-04
			6.2028628358e-05 -2.3545095986e-05 4.2648480182e-05
			6.1055575258e-05 -7.5884412886e-05 1.6014675812e-04
			5.1791209758e-05 1.3395027931e-04 1.1104672122e-04
			1.2088774586e-04 8.8024177614e-05 1.4490945512e-04
			-5.2682006942e-05 -6.8011071686e-05 1.7170114012e-04
			1.3290152586e-04 5.1430022914e-05 8.3189691822e-05
			-4.3059903150e-07 4.3308711886e-06 9.6533931422e-05
			-3.9344610042e-05 7.0527148214e-05 1.4349748412e-04
			2.8077117458e-05 -3.5081536386e-05 4.0684288422e-05
			3.4788700286e-04 -1.9149496069e-04 2.4969523762e-05
			5.7393217158e-05 9.5335932836e-06 -6.2874136778e-05
			-2.3610534914e-04 3.0386977114e-05 -2.4451966088e-04
			-5.9130873742e-05 3.8897483514e-05 -3.7233038478e-05
			1.9005746886e-04 7.9364125414e-05 -3.4629299178e-05
			-2.2491003515e-06 1.4948096031e-04 -3.5160571784e-06
			5.7602463058e-05 1.1653773731e-04 8.7576307216e-06
			-1.0477429814e-04 6.5226315214e-05 4.5613256322e-05
			-2.1520760014e-04 -3.1346046086e-05 7.2939004022e-05
			4.7488453558e-05 -2.4376298469e-04 -1.2662126488e-04
			9.2982729850e-07 4.4947489514e-05 1.2623091072e-04
			1.9849158886e-04 -2.3895455486e-05 -9.1995261878e-05
			-9.8421014242e-05 -1.2723251769e-04 2.1502166622e-05
			-7.8238919442e-05 -7.5026905386e-05 -1.5576562288e-04
			5.2400506258e-05 1.5360058031e-04 2.2530695312e-04
			-1.0537220314e-04 1.4260620131e-04 -4.9501578378e-05
			-1.8191128314e-04 -2.3108920469e-04 2.9285978662e-05
			-2.3593829214e-04 -1.7248107869e-04 7.6171067922e-05
			-3.0091204414e-04 3.0453441514e-05 8.6732211522e-05
			1.9824692486e-04 -9.8818243686e-05 3.0821947542e-05
			-3.9396488115e-06 3.4052341236e-06 2.8712943872e-05
			-1.0382118214e-04 -1.8270524269e-04 1.9142896712e-04
			-5.0723785842e-05 -4.4805537186e-05 -1.0574199988e-04
			-1.2644703842e-05 4.0363218214e-05 1.2928698312e-04
			1.9062577986e-04 -1.1091193769e-04 1.3509830712e-04
			-1.3447301814e-04 -3.0789214769e-04 -8.2163250878e-05
			-1.7856914214e-04 3.8564384714e-05 8.7546962822e-05
			2.5847539286e-04 -9.3473852186e-05 1.0556579932e-04
			1.1998508486e-04 -2.6628061986e-05 2.0016720612e-04
			-3.0925121614e-04 5.6389261814e-05 1.0068781212e-04
			2.6024921686e-04 1.9799398231e-04 -2.2615956784e-06
			2.6764075858e-05 -8.2958526586e-05 3.7212067862e-05
			8.9618887458e-05 -8.6070020886e-05 5.0242379912e-04
			-8.2390688842e-05 1.0219134681e-04 -1.5621371688e-04
			-2.4363650142e-05 1.5755992431e-04 -2.4617400488e-04
			5.5758990758e-05 -1.5930939569e-04 6.9800511522e-05
			-2.7613915942e-05 3.9438694214e-05 5.8878109922e-05
			-2.7059228214e-04 3.9299810031e-04 -2.1576705288e-04
			3.8449158558e-05 3.6859937714e-05 -1.2085163188e-04
			-5.2354073214e-04 7.8467386714e-05 1.0072801092e-04
			3.6244297658e-05 2.8087615931e-04 -1.4178050988e-04
			-1.4913211814e-04 -3.4287011469e-04 -8.9664659878e-05
			6.1435332458e-05 -1.9974812669e-04 1.7348639212e-04
			2.0432597086e-04 -1.0933468369e-04 9.0884845822e-05
			1.6224777486e-04 -4.1382225469e-04 -2.4273389288e-04
			-2.5722414314e-04 1.0751182731e-04 -1.3514321778e-05
			3.0058226886e-04 -1.3011164069e-04 -4.8382476778e-05
			1.7918526086e-04 3.9139705314e-05 -4.9877793784e-06
			0.0000000000e+00 1.9179425807e-03 -3.3219739958e-03
		&END VELOCITY
		&KIND Mo
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q14
			POTENTIAL GTH-GGA-q14
		&END KIND
		&KIND S
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q6
			POTENTIAL GTH-GGA-q6
		&END KIND
		&KIND O
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q6
			POTENTIAL GTH-GGA-q6
		&END KIND
		&KIND Ar
			BASIS_SET ORB TZV2P-MOLOPT-GGA-GTH-q8
			POTENTIAL GTH-GGA-q8
		&END KIND
	&END SUBSYS 
&END FORCE_EVAL
&MOTION
!	&COMVEL_TOL 1e-8  ! enforce |V_com| < 1e-8
	
!	&CONSTRAINT
!		&FIXED_ATOMS
!			LIST 19 36  ! why this? they seem to be close (through PBC)
!			LIST 19     ! can we do 1? Yuri chose 2
!		&END FIXED_ATOMS
!	&END CONSTRAINT 
	&FREE_ENERGY
		&METADYN
			!DO_HILLS  FALSE                                 ! default
			
			&METAVAR
				COLVAR   1
				SCALE 1.0
				
				&WALL
					POSITION [angstrom]  40.1048
					TYPE       REFLECTIVE                        ! mirror wall
					&REFLECTIVE
						DIRECTION  WALL_PLUS                        
					&END REFLECTIVE
				&END WALL
			&END METAVAR
			
			&PRINT
				&COLVAR
					FILENAME      =ion_z.dat
					COMMON_ITERATION_LEVELS 3
					&EACH                                 ! choose the stride (iteration level) :contentReference[oaicite:8]{index=8}
						MD 1                               ! every MD integration step
					&END EACH
				&END COLVAR
			&END PRINT
			
		&END METADYN
	&END FREE_ENERGY
	
	&MD
		ENSEMBLE NVE  
	!	TEMPERATURE [K] 350
		TIMESTEP [fs] 1.0
		STEPS 5000
	!	&THERMOSTAT
	!		REGION MASSIVE
	!		TYPE CSVR 
	!		&CSVR 
	!			TIMECON 200 
	!		&END CSVR 
	!	&END THERMOSTAT
	&END MD 
	
	&PRINT
		&TRAJECTORY
			&EACH
				MD 10
			&END EACH
		&END TRAJECTORY
		
		&VELOCITIES
			&EACH
				MD 10
			&END EACH
		&END VELOCITIES
		
		&FORCES OFF
		&END FORCES
		
		&RESTART_HISTORY
			&EACH
				MD 30
			&END EACH
		&END RESTART_HISTORY
		
		&RESTART
			BACKUP_COPIES 3
			&EACH
				MD 10
			&END EACH
		&END RESTART
	&END PRINT
&END 


